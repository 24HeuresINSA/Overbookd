<template>
  <div>
    <h1>Orga requis ðŸ“†</h1>
    <v-list v-for="plan in orgaRequis" :key="plan._id">
      <v-list-item>
        <v-list-item-content>
          <v-list-item-title>{{ plan._id }}</v-list-item-title>
          <v-data-table
              :headers="[
              { text: 'FT', value: 'name', width: '30%' },
              { text: 'id', value: 'count', align: 'center', width: '10%'},
              { text: 'status', value: 'status', align: 'center', width: '10%'},
              { text: 'dÃ©but', value: 'start', align: 'center', width: '10%'},
              { text: 'fin', value: 'end', align: 'center', width: '10%'},
              { text: 'conflits', value: 'conflits', width: '30%'},
            ]"
              :items="plan.fts"
              :hide-default-footer="true"
              :items-per-page="-1"
          >
            <template #item.status="{ item }">
              <v-chip
                  :color="getColor(item.status)"
              >
                {{ item.status }}
              </v-chip>
            </template>
            <template #item.count="{ item }">
              <a :href="/ft/+item.count">{{item.count}}</a>
            </template>
            <template #item.start="{ item }">
              {{ (new Date(item.start)).toLocaleString() }}
            </template>
            <template #item.end="{ item }">
              {{ (new Date(item.end)).toLocaleString() }}
            </template>
            <template #item.conflits="{ item }">
              <v-chip
                  v-for="conflit in item.conflits"
                  :key="conflit._id"
                  :color="getColor(conflit.type)"
                  class="mx-2"
              >
                {{ getText(conflit.type) }}
              </v-chip>
            </template>
          </v-data-table>
        </v-list-item-content>
      </v-list-item>
    </v-list>
  </div>
</template>

<script lang="js">
import Vue from "vue";
import {RepoFactory} from "~/repositories/repoFactory";
import {FT} from "~/utils/models/FT";

export default Vue.extend({
  name: "Planning",
  data() {
    return {
      orgaRequis: []
    };
  },
  async mounted() {
    await this.getOrgaRequis();
  },
  methods: {
    async getOrgaRequis() {
      this.orgaRequis = (await RepoFactory.ftRepo.getOrgaRequis(this)).data;
    },
    getColor(type){
      switch (type){
        case "availability":
          return "orange";
        case "TF":
          return "red";
        case "refused":
          return "red";
        case "submitted":
          return "orange";
        case "draft":
          return "grey";
        case "validated":
          return "success";
        case "ready":
          return "deep-purple";
        default:
          return "grey";
      }
    },
    getText(type){
      switch (type){
        case "availability":
          return "CONFLIT : PAS DISPO";
        case "TF":
          return "CONFLIT ENTRE FT";
        default:
          return "CONFLIT";
      }
    }
  },
});
</script>

<style scoped></style>
