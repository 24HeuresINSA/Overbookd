.test:
  stage: test
  interruptible: true
  image: node:16.17.1-alpine3.16
  script:
    - npm run test:ci

backend_test:
  extends: .test
  needs: [backend_install]
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      changes:
        - backend/**/*
    - when: never
  before_script:
    - 'cd backend'
  artifacts:
    when: always
    reports:
      junit: backend/junit.xml
      coverage_report:
        coverage_format: cobertura
        path: backend/coverage/cobertura-coverage.xml

frontend_test:
  extends: .test
  needs: [frontend_install]
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      changes:
        - frontend/**/*
    - when: never
  before_script:
    - 'cd frontend'
  artifacts:
    when: always
    reports:
      junit: frontend/junit.xml
      coverage_report:
        coverage_format: cobertura
        path: frontend/coverage/cobertura-coverage.xml