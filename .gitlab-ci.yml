workflow:
  rules:
    - if: '$CI_COMMIT_REF_NAME == "main"'
      variables:
        BASE_URL: $BASE_URL_PROD
    - if: '$CI_COMMIT_REF_NAME == "pre-prod"'
      variables:
        BASE_URL: $BASE_URL_PREPROD
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      
stages:
  - triage
  - clean-up-pipelines
  - unconfidentializer
  - install
  - check
  - test
  - docker
  - docker-scan

include:
  - local: /.gitlab/ci/triage.gitlab-ci.yml
  - local: /.gitlab/ci/clean_up_pipelines.gitlab-ci.yml
  - local: /.gitlab/ci/unconfidentializer.gitlab-ci.yml
  - template: Security/SAST.gitlab-ci.yml
  - template: Security/Secret-Detection.gitlab-ci.yml
  - template: Security/License-Scanning.gitlab-ci.yml
  - template: Security/Container-Scanning.gitlab-ci.yml
  - local: /.gitlab/ci/install.gitlab-ci.yml
  - local: /.gitlab/ci/check.gitlab-ci.yml
  - local: /.gitlab/ci/test.gitlab-ci.yml
  - local: /.gitlab/ci/docker.gitlab-ci.yml
  - local: /.gitlab/ci/docker-scan.gitlab-ci.yml
